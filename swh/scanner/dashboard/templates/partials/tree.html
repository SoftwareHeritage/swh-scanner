{% macro render_source_tree(root_path, source_tree, nodes_data, directory_content) %}
  {% if source_tree %}
    <ul>
      {% for k, v in source_tree.items()|sort(attribute='0') %}
        <li>
          {% set fpath = v.data['path'].decode() %}
          {% set rpath = fpath.split(root_path, maxsplit=1)[-1] %}
          {% set known = nodes_data.get(v.swhid())['known'] %}
          {% set known_data = directory_content(v, nodes_data) if v.object_type == 'directory' else '' %}
          {% if v.object_type == 'directory' %}
            {% set known_percent = known_data[1] * 100 // known_data[0] if known_data[0] > 0 else 0 %}
          {% elif v.object_type == 'content' %}
            {% set known_percent = 100 if known else 0 %}
          {% endif %}
          <details id="{{ v.swhid() }}"
                   class="{{ v.object_type }}"
                   data-name="{{ k.decode() }}"
                   data-swhid="{{ v.swhid() }}"
                   data-type="{{ v.object_type }}"
                   data-fpath="{{ fpath }}"
                   data-rpath="{{ rpath }}"
                   data-known="{{ known|lower }}"
                   data-known-data="{{ known_data[0] }},{{ known_data[1] }}">
            <summary>
              <span class="pie"
                    name="pie"
                    style="background: conic-gradient(orange {{ known_percent }}%, white 0)"></span>
              {{ k.decode() }}
            </summary>
          </details>
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}
